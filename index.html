<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocalize JS - Text to Speech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        input[type=range]:focus {
            outline: none;
        }

        /* Pulse Animation for Status */
        @keyframes sound-wave {
            0% { height: 4px; }
            50% { height: 16px; }
            100% { height: 4px; }
        }
        .animate-sound-wave {
            animation: sound-wave 1s infinite ease-in-out;
        }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col items-center py-10 px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <header class="mb-8 text-center max-w-2xl w-full">
        <div class="flex items-center justify-center gap-3 mb-2">
            <div class="p-3 bg-indigo-600 rounded-2xl shadow-lg shadow-indigo-200">
                <!-- Icon: Volume2 -->
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </div>
            <h1 class="text-3xl font-extrabold tracking-tight text-slate-900 sm:text-4xl">
                Vocalize JS
            </h1>
        </div>
        <p class="text-slate-500 text-lg">Pure JavaScript Text to Speech</p>
    </header>

    <!-- Main Card -->
    <main class="w-full max-w-4xl bg-white rounded-3xl shadow-xl shadow-slate-200 border border-slate-100 overflow-hidden flex flex-col md:flex-row min-h-[500px]">
        
        <!-- Left Column: Input -->
        <div class="flex-1 p-6 md:p-8 flex flex-col border-b md:border-b-0 md:border-r border-slate-100 bg-slate-50/50">
            <div class="flex items-center justify-between mb-4">
                <label class="flex items-center gap-2 text-sm font-semibold text-slate-700 uppercase tracking-wider">
                    <!-- Icon: Type -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
                    Input Text
                </label>
                <span id="char-count" class="text-xs text-slate-400 font-medium">0 chars</span>
            </div>
            <textarea 
                id="text-input"
                class="flex-1 w-full p-4 rounded-xl border border-slate-200 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-slate-700 text-lg leading-relaxed shadow-sm placeholder:text-slate-300 outline-none"
                placeholder="Type something here to listen..."
            >Hello! I am a web application created with plain JavaScript. I can read this text using the voices installed on your device.</textarea>
        </div>

        <!-- Right Column: Controls -->
        <div class="flex-1 p-6 md:p-8 flex flex-col gap-6 bg-white relative">
            
            <!-- Status Bar -->
            <div id="status-bar" class="h-14 flex items-center justify-center bg-slate-50 rounded-xl border border-slate-100 transition-colors duration-300">
                <span id="status-text" class="text-slate-400 font-medium flex items-center gap-2">Ready to speak</span>
                <div id="wave-animation" class="hidden flex items-end gap-1 ml-2 h-4">
                    <span class="w-1 bg-indigo-600 rounded-full animate-sound-wave"></span>
                    <span class="w-1 bg-indigo-600 rounded-full animate-sound-wave delay-100"></span>
                    <span class="w-1 bg-indigo-600 rounded-full animate-sound-wave delay-200"></span>
                </div>
            </div>

            <!-- Voice Select -->
            <div class="space-y-2">
                <label class="flex items-center gap-2 text-sm font-semibold text-slate-700 uppercase tracking-wider">
                    <!-- Icon: Mic -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                    Select Voice
                </label>
                <div class="flex gap-2">
                    <div class="relative flex-1">
                        <select id="voice-select" class="w-full p-3 pl-4 pr-10 rounded-xl border border-slate-200 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-slate-700 appearance-none shadow-sm font-medium outline-none truncate">
                            <option value="" disabled selected>Loading voices...</option>
                        </select>
                        <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none">
                            <!-- Icon: Chevron Down -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                    </div>
                    <button id="reload-voices-btn" class="p-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-500 hover:bg-slate-100 hover:text-indigo-600 transition-colors" title="Reload Voices">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Sliders -->
            <div class="space-y-6">
                <!-- Pitch -->
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-semibold text-slate-700">Pitch</label>
                        <span id="pitch-value" class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-600">1.0x</span>
                    </div>
                    <input type="range" id="pitch" min="0" max="2" value="1" step="0.1" class="w-full">
                </div>

                <!-- Rate -->
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-semibold text-slate-700">Speed</label>
                        <span id="rate-value" class="text-xs font-mono bg-slate-100 px-2 py-1 rounded text-slate-600">1.0x</span>
                    </div>
                    <input type="range" id="rate" min="0.5" max="2" value="1" step="0.1" class="w-full">
                </div>
            </div>

            <!-- Buttons -->
            <div class="mt-auto grid grid-cols-3 gap-3">
                <button id="play-btn" class="flex items-center justify-center gap-2 py-3 px-4 rounded-xl bg-indigo-600 text-white font-semibold shadow-lg shadow-indigo-200 hover:bg-indigo-700 hover:shadow-indigo-300 active:scale-95 transition-all">
                    <!-- Icon: Play -->
                    <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-transparent"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                    <!-- Icon: Pause (Hidden initially) -->
                    <svg id="pause-icon" class="hidden stroke-transparent" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                    <span id="play-text">Play</span>
                </button>

                <button id="stop-btn" class="flex items-center justify-center gap-2 py-3 px-4 rounded-xl bg-slate-100 text-slate-700 font-semibold hover:bg-slate-200 active:scale-95 transition-all">
                    <!-- Icon: Square -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-transparent"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                    Stop
                </button>

                <button id="reset-btn" class="flex items-center justify-center gap-2 py-3 px-4 rounded-xl border border-slate-200 text-slate-600 font-semibold hover:bg-slate-50 active:scale-95 transition-all">
                    <!-- Icon: Refresh -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                    Reset
                </button>
            </div>

        </div>
    </main>

    <footer class="mt-8 text-slate-400 text-sm">
        Uses built-in Web Speech API
    </footer>

    <script>
        // --- Variables ---
        const synth = window.speechSynthesis;
        const textInput = document.getElementById('text-input');
        const voiceSelect = document.getElementById('voice-select');
        const pitchInput = document.getElementById('pitch');
        const rateInput = document.getElementById('rate');
        const pitchValue = document.getElementById('pitch-value');
        const rateValue = document.getElementById('rate-value');
        const charCount = document.getElementById('char-count');
        
        // Buttons
        const playBtn = document.getElementById('play-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');
        const reloadVoicesBtn = document.getElementById('reload-voices-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const playText = document.getElementById('play-text');

        // UI Feedback
        const statusBar = document.getElementById('status-bar');
        const statusText = document.getElementById('status-text');
        const waveAnimation = document.getElementById('wave-animation');

        let voices = [];
        let isPaused = false;
        let voiceLoadInterval;

        // --- Functions ---

        const loadVoices = () => {
            // Some browsers return voices immediately, others async
            const availableVoices = synth.getVoices();
            
            if(availableVoices.length > 0) {
                voices = availableVoices;
                // Stop polling if we found voices
                if(voiceLoadInterval) clearInterval(voiceLoadInterval);
            } else {
                return; // Keep waiting, don't clear list yet if it's just a timing issue
            }
            
            // Clear existing options
            voiceSelect.innerHTML = '';
            
            // Group voices by language for a cleaner UI
            // Simple sorting first
            voices.sort(function (a, b) {
                const aname = a.name.toUpperCase();
                const bname = b.name.toUpperCase();
                if (aname < bname) return -1;
                else if (aname == bname) return 0;
                else return +1;
            });

            voices.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                option.setAttribute('data-lang', voice.lang);
                option.setAttribute('data-name', voice.name);
                
                // Select default voice automatically
                if (voice.default) {
                    option.selected = true;
                }
                voiceSelect.appendChild(option);
            });
        };
        
        // Fallback for when voices are empty (common in Chrome/Canvas)
        const initVoiceLoad = () => {
             loadVoices();
             // Poll for voices every 100ms for 3 seconds
             let attempts = 0;
             voiceLoadInterval = setInterval(() => {
                 loadVoices();
                 attempts++;
                 if (attempts > 30) clearInterval(voiceLoadInterval);
             }, 100);
        };

        const updateStatus = (state) => {
            // States: 'idle', 'playing', 'paused'
            if (state === 'playing') {
                statusBar.classList.remove('bg-slate-50', 'border-slate-100');
                statusBar.classList.add('bg-indigo-50', 'border-indigo-100');
                
                statusText.classList.remove('text-slate-400', 'text-amber-600');
                statusText.classList.add('text-indigo-700');
                statusText.textContent = "Speaking...";
                
                waveAnimation.classList.remove('hidden');
                
                // Button State: Show Pause
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                playText.textContent = "Pause";
                playBtn.classList.replace('bg-indigo-600', 'bg-amber-100');
                playBtn.classList.replace('text-white', 'text-amber-700');
                playBtn.classList.remove('shadow-indigo-200');

            } else if (state === 'paused') {
                statusText.textContent = "Paused";
                statusText.classList.replace('text-indigo-700', 'text-amber-600');
                waveAnimation.classList.add('hidden');

                // Button State: Show Resume
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                playText.textContent = "Resume";
                playBtn.classList.replace('bg-amber-100', 'bg-indigo-600');
                playBtn.classList.replace('text-amber-700', 'text-white');
                playBtn.classList.add('shadow-indigo-200');

            } else { // Idle
                statusBar.classList.add('bg-slate-50', 'border-slate-100');
                statusBar.classList.remove('bg-indigo-50', 'border-indigo-100');
                
                statusText.classList.add('text-slate-400');
                statusText.classList.remove('text-indigo-700', 'text-amber-600');
                statusText.textContent = "Ready to speak";
                
                waveAnimation.classList.add('hidden');

                // Button State: Show Play
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                playText.textContent = "Play";
                playBtn.classList.replace('bg-amber-100', 'bg-indigo-600');
                playBtn.classList.replace('text-amber-700', 'text-white');
                playBtn.classList.add('shadow-indigo-200');
                isPaused = false;
            }
        };

        const speak = () => {
            if (synth.speaking) {
                // If currently speaking and we clicked button, we want to pause
                if (!isPaused) {
                    synth.pause();
                    isPaused = true;
                    updateStatus('paused');
                } else {
                    synth.resume();
                    isPaused = false;
                    updateStatus('playing');
                }
                return;
            }

            if (textInput.value !== '') {
                const speakText = new SpeechSynthesisUtterance(textInput.value);
                
                // Find selected voice object
                const selectedOption = voiceSelect.selectedOptions[0];
                const selectedName = selectedOption.getAttribute('data-name');
                
                voices.forEach(voice => {
                    if (voice.name === selectedName) {
                        speakText.voice = voice;
                    }
                });

                speakText.rate = rateInput.value;
                speakText.pitch = pitchInput.value;

                speakText.onstart = () => {
                    updateStatus('playing');
                }

                speakText.onend = () => {
                    updateStatus('idle');
                }

                speakText.onerror = () => {
                    console.error('Speech synthesis error');
                    updateStatus('idle');
                }

                synth.speak(speakText);
            }
        };

        const stop = () => {
            synth.cancel();
            isPaused = false;
            updateStatus('idle');
        };

        // --- Event Listeners ---

        // Load voices on startup
        initVoiceLoad();
        
        // Chrome async voice loading event
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        
        // Manual reload button
        reloadVoicesBtn.addEventListener('click', () => {
            voiceSelect.innerHTML = '<option value="" disabled selected>Reloading...</option>';
            initVoiceLoad();
        });

        // Play Button
        playBtn.addEventListener('click', speak);

        // Stop Button
        stopBtn.addEventListener('click', stop);

            // Reset Voice to default
            if(voices.length > 0) {
                 const defaultVoice = voices.find(v => v.default) || voices[0];
                 // Loop to find the option with matching name
                 for(let i=0; i<voiceSelect.options.length; i++) {
                     if(voiceSelect.options[i].getAttribute('data-name') === defaultVoice.name) {
                         voiceSelect.selectedIndex = i;
                         break;
                     }
                 }
            }
        });

        // Sliders Update
        pitchInput.addEventListener('input', e => pitchValue.textContent = e.target.value + 'x');
        rateInput.addEventListener('input', e => rateValue.textContent = e.target.value + 'x');
        
        // Changing sliders while playing should restart speech with new settings
        // (Optional: Chrome doesn't support dynamic pitch change mid-speech, requires restart)
        const restartIfSpeaking = () => {
            if(synth.speaking && !isPaused) {
                synth.cancel();
                // Short timeout to ensure cancel clears
                setTimeout(speak, 100);
            }
        };

        pitchInput.addEventListener('change', restartIfSpeaking);
        rateInput.addEventListener('change', restartIfSpeaking);
        voiceSelect.addEventListener('change', restartIfSpeaking);

        // Character Count
        textInput.addEventListener('input', (e) => {
            charCount.textContent = e.target.value.length + " chars";
        });
        
        // Initial char count
        charCount.textContent = textInput.value.length + " chars";

    </script>
</body>
</html>
